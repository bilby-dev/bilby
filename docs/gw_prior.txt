.. gw_prior:

===================================
Transient Gravitational wave priors
===================================

We provide two base prior dictionaries for binary black hole (BBH) and binary
neutron star (BNS) systems. These are :code:`bilby.gw.prior.BBHPriorDict` and
:code:`bilby.gw.prior.BNSPriorDict` respectively. For BBHs this generates all
the BBH mass parameters so constraints can be placed on any mass parameters.
For BNSs it also generates the tidal deformability parameters.

You can load in the default priors by running, e.g.

.. code:: python

   >>> prior = bilby.gw.prior.BBHPriorDict()

This prior has a complete set of parameters for a BBH system. You can modify
this, for example to set a different prior range for the chirp mass

.. code:: python

   >>> prior["chirp_mass"] = bilby.core.prior.Uniform(30, 31, "chirp_mass")

.. note::
   If you are using a tidal waveform, you need to specify a frequency domain
   source model which includes tidal effects, e.g.

    .. code:: python

     frequency_domain_source_model=lal_binary_neutron_star


Prior files
===========

As an alternative to specifying the prior in a python script, we also provide
the ability to use a prior file. For example, given a file :code:`bbh.prior`
which contains:

.. literalinclude:: /../bilby/gw/prior_files/precessing_spins_bbh.prior

You can load this with

.. code:: python

   prior = bilby.gw.prior.BBHPriorDict("bbh.prior")

Here we see several examples of different types of priors. For those available
in the :code:`bilby.core.prior` module, you can specify these without a prefix,
but for other (including any existing in your own modules) you need to specify
the module path.

Aligned spins waveform with tides off
-------------------------------------

.. literalinclude:: /../bilby/gw/prior_files/aligned_spins_bbh.prior

Aligned spins waveform with tides on
------------------------------------

.. literalinclude:: /../bilby/gw/prior_files/aligned_spins_bns.prior

Precessing spins waveform with tides off
----------------------------------------

.. literalinclude:: /../bilby/gw/prior_files/precessing_spins_bbh.prior

Precessing spins waveform with tides on
---------------------------------------

.. literalinclude:: /../bilby/gw/prior_files/precessing_spins_bns.prior


CBC waveform augmented with sine-Gaussian bursts
------------------------------------------------

To use the :func:`bilby.gw.source.cbc_plus_sine_gaussians` waveform in a
configuration-driven analysis you need to instruct both the waveform generator
and the prior dictionary to bundle the sine-Gaussian parameters correctly.  The
following snippet shows the relevant entries for a configuration file using one
additional sine-Gaussian component:

.. code-block:: ini

   [waveform_generator]
   frequency_domain_source_model = bilby.gw.source.cbc_plus_sine_gaussians
   parameter_conversion = bilby.gw.conversion.convert_to_cbc_plus_sine_gaussian_parameters

   [prior]
   conversion_function = bilby.gw.conversion.generate_all_cbc_plus_sine_gaussian_parameters
   sine_gaussian_0_hrss = LogUniform(name='sine_gaussian_0_hrss', minimum=1e-24, maximum=1e-20)
   sine_gaussian_0_Q = Uniform(name='sine_gaussian_0_Q', minimum=3, maximum=30)
   sine_gaussian_0_frequency = Uniform(name='sine_gaussian_0_frequency', minimum=50, maximum=512)
   sine_gaussian_0_time_offset = Uniform(name='sine_gaussian_0_time_offset', minimum=-0.05, maximum=0.05)
   sine_gaussian_0_phase_offset = Uniform(name='sine_gaussian_0_phase_offset', minimum=-3.141592653589793, maximum=3.141592653589793)

Each additional burst is specified by increasing the index in the parameter
name (e.g. :code:`sine_gaussian_1_hrss`, :code:`sine_gaussian_1_Q`,
:code:`sine_gaussian_1_frequency`).  The conversion function assembles all
entries that match this naming scheme into the
:code:`sine_gaussian_parameters` list consumed by the waveform model.  Each
burst must specify all five quantities (``hrss``, ``Q``, ``frequency``,
``time_offset`` and ``phase_offset``), so the priors above fully describe the
additional burst while leaving the standard CBC priors unchanged.

To configure detector-local incoherent bursts, extend the naming scheme to
include the interferometer label, e.g. :code:`sine_gaussian_0_H1_hrss` and
:code:`sine_gaussian_0_L1_hrss`.  Parameters matching
``sine_gaussian_<index>_<detector>_<field>`` are grouped into the
``incoherent_sine_gaussian_parameters`` mapping and added directly to the
corresponding detector strain without antenna projections.  The same required
fields apply (``hrss``, ``Q``, ``frequency``, ``time_offset`` and
``phase_offset``) with an optional ``polarization`` selector when per-detector
components should contribute either the plus or cross polarisation.

Example configuration and prior files for coherent and incoherent burst
setups are provided in :code:`examples/gw_examples/data_examples` as
``GW231123_cbc_plus_sine_gaussians_coherent`` and
``GW231123_cbc_plus_sine_gaussians_incoherent`` respectively.


Modifying the prior
-------------------

Taking the example priors above, you can copy and modify them to suite your
needs. For example, to fix a parameter to a given value

.. code:: python

  parameter_name = <value>

while to constrain the prior to a certain range , you can use:

.. code:: python

 parameter_name = Constraint(name='parameter_name', minimum=<value>, maximum=<value>)


Priors using a Jupyter notebook
===============================

Bilby saves as output the prior volume sampled. You might also find useful to
produce priors directly from a Jupyter notebook. You can have a look at one of
the Bilby tutorials to check how you define and plot priors in a Jupyter notebook:
`making_priors.ipynb <https://github.com/bilby-dev/bilby/-/blob/master/examples/tutorials/making_priors.ipynb>`_.

